@page "/"

@implements IDisposable

<PageTitle>Tasks</PageTitle>

@if (Tasks is not null)
{
    @foreach (var task in Tasks)
    {
        <TaskCard Task="task" TaskChanged="TaskChanged"></TaskCard>
    }
}

@code {
    List<TaskObject> Tasks { get; set; }

    private UnitOfWork Uow { get; set; }

    protected override void OnInitialized()
    {
        if (Tasks == null)
        {
            Tasks = new List<TaskObject>();
            Uow = new UnitOfWork();
            Tasks = Uow.Query<TaskObject>().OrderBy(x => x.Order).ToList();
        }

        base.OnInitialized();
    }

    private void TaskChanged()
    {
        Uow.CommitChanges();
    }

    public void Dispose()
    {
        Uow?.Dispose();
    }
}